---
- name: ActiveMQ | Create directory for user
  file: 
    path=/opt/activemq 
    state=directory
  tags:
    [install, activemq]

- name: ActiveMQ | Create user
  user: 
    name=activemq 
    home=/opt/activemq
  tags:
    [install, activemq]

- name: ActiveMQ | Download
  get_url:
    url=http://www.apache.org/dyn/closer.cgi?filename=/activemq/{{ ACTIVEMQ_VERSION }}/apache-activemq-{{ ACTIVEMQ_VERSION }}-bin.tar.gz&action=download 
    dest=/opt/activemq 
    checksum=sha1:1bff4945f9a55bbb11374fd8205f2e919e605abf
  tags:
    [install, activemq]

- name: ActiveMQ | Unpack
  unarchive: 
    src=/opt/activemq/apache-activemq-{{ ACTIVEMQ_VERSION }}-bin.tar.gz 
    dest=/opt/activemq/
  tags:
    [install, activemq]

- name: ActiveMQ | Create symlink to current dir
  file: 
    src=/opt/activemq/apache-activemq-{{ ACTIVEMQ_VERSION }} 
    dest=/opt/activemq/current 
    owner=activemq 
    group=users 
    state=link
  tags:
    [install, activemq]

- name: ActiveMQ | Copy ENV
  copy: 
    src=/opt/activemq/current/bin/env 
    dest=/etc/default/activemq 
    mode=0644
  tags:
    [install, activemq]

- name: ActiveMQ | Change user name and password
  lineinfile: 
    dest=/etc/default/activemq 
    regexp=~s/^ACTIVEMQ_USER= 
    line=ACTIVEMQ_USER="activemq" 
    state=present
  tags:
    [install, activemq]

- name: ActiveMQ | Create symlink for service
  file: 
    src=/opt/activemq/current/bin/activemq 
    dest=/etc/init.d/activemq 
    state=link
  tags:
    [install, activemq]