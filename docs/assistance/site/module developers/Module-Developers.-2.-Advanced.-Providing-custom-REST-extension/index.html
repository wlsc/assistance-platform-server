<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">

	<title>Module Developers. 2. Advanced. Providing custom REST extension - Assistance Platform</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Assistance Platform</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Client <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../client/Client-Feedback-Channel-Format/">Client Feedback Channel Format</a>
</li>

                        
                            
<li >
    <a href="../../client/Client-actions-and-commands/">Client actions and commands</a>
</li>

                        
                            
<li >
    <a href="../../client/REST-API-for-Clients/">REST API for Clients</a>
</li>

                        
                            
<li >
    <a href="../../client/Sensor-Types-and-API-mapping/">Sensor Types and API mapping</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Deploy <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../deploy/Deploying-via-Docker/">Deploying via Docker</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Load testing <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../load%20testing/Z.-Internal-Deployment-Notes/">Z. Internal Deployment Notes</a>
</li>

                        
                            
<li >
    <a href="../../load%20testing/Z2.-Load-Test---Deployment/">Z2. Load Test   Deployment</a>
</li>

                        
                            
<li >
    <a href="../../load%20testing/Z2.-Load-Test-Get-Performance-Metrics/">Z2. Load Test Get Performance Metrics</a>
</li>

                        
                            
<li >
    <a href="../../load%20testing/Z4.-Load-Test-Setup-JMeter/">Z4. Load Test Setup JMeter</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Module developers <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../Module-Developers.-1.-Getting-started-for-Module-Developers-%28WIP%29/">Module Developers. 1. Getting started for Module Developers (WIP)</a>
</li>

                        
                            
<li class="active">
    <a href="./">Module Developers. 2. Advanced. Providing custom REST extension</a>
</li>

                        
                            
<li >
    <a href="../Module-Developers.-3.-Dockerize-your-module/">Module Developers. 3. Dockerize your module</a>
</li>

                        
                            
<li >
    <a href="../Preprocess-events-before-save-and-distribution/">Preprocess events before save and distribution</a>
</li>

                        
                            
<li >
    <a href="../REST-API-for-Modules-%28internal%29/">REST API for Modules (internal)</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../Module-Developers.-1.-Getting-started-for-Module-Developers-%28WIP%29/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../Module-Developers.-3.-Dockerize-your-module/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#purpose-of-rest-api-extensions">Purpose of REST API Extensions</a></li>
        
    
        <li class="main "><a href="#how-does-this-extension-from-a-communication-perspective-work">How does this extension from a communication perspective work?</a></li>
        
    
        <li class="main "><a href="#how-can-i-implement-a-rest-extension-for-my-module">How can I implement a REST extension for my module?</a></li>
        
    
        <li class="main "><a href="#how-to-know-which-user-started-the-request">How to know which user started the request?</a></li>
        
    
        <li class="main "><a href="#how-to-access-cassandra-inside-the-custom-endpoint">How to access Cassandra inside the custom endpoint?</a></li>
        
    
        <li class="main "><a href="#how-to-excactly-reach-these-endpoints">How to excactly reach these endpoints?</a></li>
        
            <li><a href="#from-client-perspective-via-platform">From client perspective via platform</a></li>
        
            <li><a href="#for-testing-purposes">For testing purposes</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p>This document will provide you with information about extending the platforms REST API by providing module specific REST endpoints.</p>
<h1 id="purpose-of-rest-api-extensions">Purpose of REST API Extensions</h1>
<p>In some cases there can be a need for clients that are specialized for a specific module. In order to be special these special clients need to access some REST API which offers more (specialized) endpoints than the generalized Platform API. For example the "Drive Calm" example module could offer a special endpoint where it provides a list of all speed exceedings of the last month. Or a "action" endpoint to clear the data, set specific setting, etc..</p>
<h1 id="how-does-this-extension-from-a-communication-perspective-work">How does this extension from a communication perspective work?</h1>
<p>The client knows the IDs of modules. He then can make a normal HTTP request to <code>/assistance/:module/custom/*path</code>. The platform then will lookup the IP of the modules REST server and forward the request to <code>*path</code> on the modules REST server. 
<img alt="" src="https://github.com/Telecooperation/server_platform_assistance/blob/master/DeveloperDoc/Images/ModuleRestCommunication.png?raw=true" /></p>
<h1 id="how-can-i-implement-a-rest-extension-for-my-module">How can I implement a REST extension for my module?</h1>
<p>In order to build a REST extension you just need to implement the <code>generateCustomServlets()</code> in your <code>AssistanceModule</code> sub-class.</p>
<p>You can use normal servlets and wrap them with the <code>MappedServlet</code> class to map the paths. The constructor <code>MappedServlet</code> used in the following example maps a basic Jersey service class - this is the recommended way. But however you can also pass your custom <code>ServletHolder</code>, if required. <strong>Note:</strong> When using the Jersey way, then you need to make sure, that all your servlets live in their own packages, otherwise the path mapping will be confused!</p>
<pre><code class="java">    @Override
    protected Collection&lt;MappedServlet&gt; generateCustomServelets() {
        MappedServlet example = new MappedServlet(&quot;/example&quot;, ExampleService.class);

        return Arrays.asList(example);
    }
</code></pre>

<p>A example Jersey service could look like:</p>
<pre><code class="java">package de.tudarmstadt.informatik.tk.assistanceplatform.modules.example.assistance.examplews;

import javax.ws.rs.Consumes;
import javax.ws.rs.GET;
import javax.ws.rs.POST;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import javax.ws.rs.core.MediaType;

@Path(&quot;/&quot;)
public class ExampleService {
    @Path(&quot;/test&quot;)
    @GET
    @Produces(MediaType.APPLICATION_JSON)
    public String test() {
        return &quot;{'test' : 'yes'}&quot;;
    }

    @POST
    @Path(&quot;/posttest&quot;)
    @Produces(MediaType.APPLICATION_JSON)
    @Consumes(MediaType.APPLICATION_JSON)
    public String posttest(String postData) {
        return postData;
    }
}
</code></pre>

<h1 id="how-to-know-which-user-started-the-request">How to know which user started the request?</h1>
<p>Just read the <code>ASSISTANCE-USER-ID</code> HTTP-Header-Field.</p>
<h1 id="how-to-access-cassandra-inside-the-custom-endpoint">How to access Cassandra inside the custom endpoint?</h1>
<p><code>ServiceResourcesFactory.getInstance().getAssistanceModule().getCassandraSession()</code></p>
<h1 id="how-to-excactly-reach-these-endpoints">How to excactly reach these endpoints?</h1>
<h2 id="from-client-perspective-via-platform">From client perspective via platform</h2>
<p>The client should always go over the platform and can reach the custom endpoint (for the example above) on the following URLs: <code>http://platform/assistance/{idOfExampleModule}/custom/example/test</code>and <code>http://platform/assistance/{idOfExampleModule}/custom/example/posttest</code></p>
<h2 id="for-testing-purposes">For testing purposes</h2>
<p>For testing just your module REST service you can use:
<code>http://localhost:21314/rest/custom/example/test</code>and <code>http://localhost:21314/rest/custom/example/posttest</code>.</p>
<p>So like you can see <code>http://localhost:21314/rest/custom/</code> is the API fixed part of the URL, everything afterwards is specified by your servlet implementation.</p></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
