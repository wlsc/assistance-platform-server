<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">

	<title>Module Developers. 3. Dockerize your module - Assistance Platform</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Assistance Platform</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Client <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../client/Client-Feedback-Channel-Format/">Client Feedback Channel Format</a>
</li>

                        
                            
<li >
    <a href="../../client/Client-actions-and-commands/">Client actions and commands</a>
</li>

                        
                            
<li >
    <a href="../../client/REST-API-for-Clients/">REST API for Clients</a>
</li>

                        
                            
<li >
    <a href="../../client/Sensor-Types-and-API-mapping/">Sensor Types and API mapping</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Deploy <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../deploy/Deploying-via-Docker/">Deploying via Docker</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Load testing <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../load%20testing/Z.-Internal-Deployment-Notes/">Z. Internal Deployment Notes</a>
</li>

                        
                            
<li >
    <a href="../../load%20testing/Z2.-Load-Test---Deployment/">Z2. Load Test   Deployment</a>
</li>

                        
                            
<li >
    <a href="../../load%20testing/Z2.-Load-Test-Get-Performance-Metrics/">Z2. Load Test Get Performance Metrics</a>
</li>

                        
                            
<li >
    <a href="../../load%20testing/Z4.-Load-Test-Setup-JMeter/">Z4. Load Test Setup JMeter</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Module developers <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../Module-Developers.-1.-Getting-started-for-Module-Developers-%28WIP%29/">Module Developers. 1. Getting started for Module Developers (WIP)</a>
</li>

                        
                            
<li >
    <a href="../Module-Developers.-2.-Advanced.-Providing-custom-REST-extension/">Module Developers. 2. Advanced. Providing custom REST extension</a>
</li>

                        
                            
<li class="active">
    <a href="./">Module Developers. 3. Dockerize your module</a>
</li>

                        
                            
<li >
    <a href="../Preprocess-events-before-save-and-distribution/">Preprocess events before save and distribution</a>
</li>

                        
                            
<li >
    <a href="../REST-API-for-Modules-%28internal%29/">REST API for Modules (internal)</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>
            

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                
                    <li >
                        <a rel="next" href="../Module-Developers.-2.-Advanced.-Providing-custom-REST-extension/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../Preprocess-events-before-save-and-distribution/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#maven-setup">Maven Setup</a></li>
        
    
        <li class="main "><a href="#dockerize-your-module">Dockerize your module</a></li>
        
            <li><a href="#dockerfile">Dockerfile</a></li>
        
            <li><a href="#build-docker-image">Build docker image</a></li>
        
            <li><a href="#run-docker-image">Run docker image</a></li>
        
    
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<p>Since the Assistance Platform uses Docker for deployment and virtualization management it is recommended that you "dockerize" also your modules. This document provides you with the necessary steps to do so.</p>
<h1 id="maven-setup">Maven Setup</h1>
<p>At first you want to setup your maven project, especially in order for it to produce a FAT jar for Apache Spark. Therefore add the following plugin to your <code>pom.xml</code>. NOTE that you need to replace <code>YOUR_MAIN_CLASS</code> with the absolute name of the class that contains your main method (e.g. de.tudarmstadt.informatik.tk.assistanceplatform.drivecalm.module.DriveCalmModuleBundle).</p>
<pre><code class="xml">            &lt;!-- Maven Assembly Plugin --&gt;
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;
                &lt;version&gt;2.5&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;!-- get all project dependencies --&gt;
                    &lt;descriptorRefs&gt;
                        &lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;
                    &lt;/descriptorRefs&gt;
                    &lt;!-- MainClass in mainfest make a executable jar --&gt;
                    &lt;archive&gt;
                        &lt;manifest&gt;
                            &lt;mainClass&gt;YOUR_MAIN_CLASS&lt;/mainClass&gt;
                        &lt;/manifest&gt;
                    &lt;/archive&gt;

                &lt;/configuration&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;id&gt;make-assembly&lt;/id&gt;
                        &lt;!-- bind to the packaging phase --&gt;
                        &lt;phase&gt;package&lt;/phase&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;single&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
       &lt;/plugins&gt;
  &lt;/build&gt;
</code></pre>

<h1 id="dockerize-your-module">Dockerize your module</h1>
<h2 id="dockerfile">Dockerfile</h2>
<p>You need to write a <code>Dockerfile</code> (yes, thats the exact name of the file) in order to dockerize your application. </p>
<p>Create a file with the following contents, however note that you need to fill out the following three parameters:
<em> YOURMODULE - The name of your project. In order to find out the exact jar file name, just run <code>mvn package</code> in the Terminal.
</em> YOURMODULEID - The ID for your bundle specified in your <code>ModuleBundle</code> implementation
* YOUR_MAIN_CLASS - Like in maven the absolute name of your main class (e.g <code>de.tudarmstadt.informatik.tk.assistanceplatform.drivecalm.module.DriveCalmModuleBundle</code>)</p>
<pre><code>FROM maven:3-jdk-8

WORKDIR /code

# Prepare by downloading dependencies
ADD pom.xml /code/pom.xml
RUN [&quot;mvn&quot;, &quot;dependency:resolve&quot;]
RUN [&quot;mvn&quot;, &quot;verify&quot;]

# Adding source, compile and package into a fat jar
ADD src /code/src
RUN [&quot;mvn&quot;, &quot;package&quot;]
RUN [&quot;cp&quot;,&quot;target/YOURMODULE-jar-with-dependencies.jar&quot;,&quot;/root/YOURMODULEID.jar&quot;]

ENTRYPOINT [&quot;mvn&quot;,&quot;exec:java&quot;,&quot;-D&quot;,&quot;exec.mainClass=YOUR_MAIN_CLASS&quot;]
</code></pre>

<h2 id="build-docker-image">Build docker image</h2>
<p>Now <code>cd</code> into your module directory (which contains the <code>Dockerfile</code>). 
Then run: <code>docker build -t (DOCKERHUB_USERNAME/)YOUR_MODULE_NAME .</code></p>
<p>This will create the respective docker image. If you want to publish to an remote repository you need to adjust the <code>-t</code> parameter respectively. </p>
<h2 id="run-docker-image">Run docker image</h2>
<p>Now you can run an instance of your module by typing <code>docker run YOUR_MODULE_NAME</code>. Use <code>docker run -d YOUR_MODULE_NAME</code> to dettach from output (for background process). </p>
<p><strong>Advice:</strong> If there are multiple modules running on the same machine, then pass the Module-REST-Port as argument to the main method via <code>-Dexec.args</code>. You can also do so for the IP.</p></div>
            
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>var base_url = '../..';</script>
        <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
        <script src="../../js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>

    </body>
</html>
